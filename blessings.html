<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é©¬å¹´å¥”è…¾ Â· é›†ç¦è¿æ˜¥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            background: linear-gradient(145deg, #9f2e2e, #6f1c1c);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'æ¥·ä½“', 'KaiTi', 'åæ–‡æ¥·ä½“', 'STKaiti', serif;
            padding: 16px;
        }

        .game-box {
            max-width: 800px;
            width: 100%;
            background: #fde7c4;
            background-image: radial-gradient(circle at 30% 40%, #ffdba6 0%, #f7c77b 100%);
            border-radius: 80px 80px 50px 50px;
            padding: 30px 25px 40px;
            box-shadow: 0 25px 35px rgba(110, 30, 20, 0.6), inset 0 0 0 6px #ffd78c, inset 0 0 15px #fff1b5;
            border: 5px solid #e5a136;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #b6442a;
            border-radius: 60px;
            padding: 12px 25px;
            margin-bottom: 30px;
            border: 3px solid #ffbb77;
            box-shadow: 0 8px 0 #732818;
        }

        .greeting {
            font-size: 34px;
            font-weight: bold;
            color: #ffec9e;
            text-shadow: 4px 4px 0 #a3351f;
            letter-spacing: 6px;
        }

        .score-area {
            background: #fdebb3;
            border-radius: 50px;
            padding: 8px 25px;
            font-size: 28px;
            color: #a13018;
            font-weight: 800;
            border: 3px solid #f8c15e;
            box-shadow: inset 0 -4px 0 #c09a4b;
        }

        .canvas-area {
            background: #cc8b5a;
            background-image: linear-gradient(165deg, #be7a45 0%, #e3b37c 80%);
            border-radius: 70px;
            padding: 20px;
            border: 5px solid #fec47c;
            box-shadow: inset 0 -8px 0 #8b551f, 0 15px 15px #4f2818;
        }

        canvas {
            display: block;
            width: 100%;
            height: auto;
            background: #ecdbba;
            border-radius: 50px;
            box-shadow: 0 0 0 6px #fad38f, inset 0 0 0 5px #fff1c9;
            cursor: pointer;
            image-rendering: crisp-edges;
        }

        .blessings-board {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px 15px;
            margin: 30px 0 20px;
            background: #ecc489;
            padding: 20px 15px;
            border-radius: 60px;
            border: 4px solid #f5b957;
            box-shadow: inset 0 -4px 0 #b47d40;
        }

        .bless-tile {
            background: #fef1ce;
            border-radius: 40px;
            padding: 8px 22px;
            font-size: 22px;
            font-weight: bold;
            color: #923e1e;
            box-shadow: 0 5px 0 #b5712f, inset 0 2px 12px #ffeeaa;
            border: 2px solid #ffcf7a;
            transition: 0.2s;
            text-align: center;
            white-space: nowrap;
        }

        .bless-tile.collected {
            background: #fccf8b;
            color: #5b3018;
            box-shadow: 0 5px 0 #936a31, inset 0 0 0 2px #fff1b0;
            opacity: 0.9;
            filter: drop-shadow(0 0 6px gold);
            border-color: #ffb82e;
        }

        .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .message-box {
            background: #a84127;
            border-radius: 40px;
            padding: 12px 25px;
            font-size: 26px;
            color: #fef7b6;
            border: 3px solid #f3b259;
            box-shadow: inset 0 -5px 0 #712f1b;
            flex: 1;
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-reset {
            background: #fec85a;
            border: none;
            font-size: 36px;
            font-family: 'æ¥·ä½“', serif;
            font-weight: bold;
            padding: 10px 30px;
            border-radius: 60px;
            color: #732818;
            cursor: pointer;
            box-shadow: 0 9px 0 #b56f2a, 0 8px 15px #391e12;
            transition: 0.04s;
            border: 3px solid #ffd58c;
            line-height: 1.2;
        }

        .btn-reset:active {
            transform: translateY(7px);
            box-shadow: 0 2px 0 #b56f2a, 0 6px 12px #391e12;
        }

        .win-overlay {
            background: #d42418e0;
            border-radius: 50px;
            padding: 5px 15px;
            font-size: 30px;
            color: #ffefb2;
            text-shadow: 2px 2px 0 #691f0e;
        }
    </style>
</head>
<body>
<div class="game-box">
    <div class="header">
        <span class="greeting">ğŸ é©¬å¹´åˆ°</span>
        <div class="score-area" id="scoreDisplay">0 / 6</div>
    </div>

    <div class="canvas-area">
        <canvas id="gameCanvas" width="700" height="400"></canvas>
    </div>

    <!-- ç¥ç¦è¯­æ”¶é›†å±•ç¤ºæ  -->
    <div class="blessings-board" id="blessBoard">
        <div class="bless-tile" data-id="0">ğŸ´ é©¬åˆ°æˆåŠŸ</div>
        <div class="bless-tile" data-id="1">ğŸ‡ ä¸€é©¬å½“å…ˆ</div>
        <div class="bless-tile" data-id="2">ğŸƒ é¾™é©¬ç²¾ç¥</div>
        <div class="bless-tile" data-id="3">âœ¨ ä¸‡é©¬å¥”è…¾</div>
        <div class="bless-tile" data-id="4">ğŸ‹ é©¬å¹´å¤§å‰</div>
        <div class="bless-tile" data-id="5">ğŸŒ¾ ç­–é©¬æ‰¬é­</div>
    </div>

    <div class="footer">
        <div class="message-box" id="messageArea">è½»ç‚¹å¥”è·‘çš„éªé©¬ï¼Œæ”¶é›†ç¥ç¦~</div>
        <button class="btn-reset" id="resetBtn">ğŸ æ–°ç¨‹</button>
    </div>
</div>

<script>
    (function() {
        // ---------- é©¬å¹´ç¥ç¦è¯­åº“ (å…±å…­å¥) ----------
        const BLESSINGS = [
            "é©¬åˆ°æˆåŠŸ",
            "ä¸€é©¬å½“å…ˆ",
            "é¾™é©¬ç²¾ç¥",
            "ä¸‡é©¬å¥”è…¾",
            "é©¬å¹´å¤§å‰",
            "ç­–é©¬æ‰¬é­"
        ];

        // æ¯ä¸ªç¥ç¦å¯¹åº”ä¸€ä¸ªå›¾æ ‡ (ç”¨äºç”»é©¬èº«ä¸Šçš„è£…é¥°)
        const BLESS_ICON = ['ğŸ´', 'ğŸ‡', 'ğŸƒ', 'âœ¨', 'ğŸ‹', 'ğŸŒ¾'];

        // æ¸¸æˆçŠ¶æ€
        let collected = [false, false, false, false, false, false]; // æ˜¯å¦å·²æ”¶é›†
        let collectedCount = 0;
        let horses = [];              // å­˜å‚¨é©¬åŒ¹æ•°æ® { x, y, blessId, speedX, speedY, active }
        let gameWidth = 700;
        let gameHeight = 400;
        let animationFrame = null;
        let canvas = document.getElementById('gameCanvas');
        let ctx = canvas.getContext('2d');
        let messageEl = document.getElementById('messageArea');
        let scoreEl = document.getElementById('scoreDisplay');
        const blessTiles = document.querySelectorAll('.bless-tile');

        // é¼ æ ‡/è§¦æ‘¸åæ ‡
        let mouseX = 0, mouseY = 0;

        // ---------- åˆå§‹åŒ–æˆ–é‡ç½® ----------
        function resetGame() {
            collected = [false, false, false, false, false, false];
            collectedCount = 0;
            horses = [];

            // ç”Ÿæˆ6åŒ¹å°é©¬ï¼Œæ¯ä¸ªå¯¹åº”ä¸€å¥ç¥ç¦ (blessId 0~5)
            for (let i = 0; i < 6; i++) {
                // éšæœºä½ç½®ï¼Œä½†é¿å…é‡å å¤ªå‰å®³ (ç®€å•é”™å¼€)
                let overlap = true;
                let attempts = 0;
                let newX, newY;
                while (overlap && attempts < 2000) {
                    newX = 80 + Math.random() * (gameWidth - 180);
                    newY = 60 + Math.random() * (gameHeight - 140);
                    overlap = horses.some(h => Math.hypot(h.x - newX, h.y - newY) < 55);
                    attempts++;
                }
                horses.push({
                    x: newX || 150 + i * 70,
                    y: newY || 100 + (i % 3) * 70,
                    blessId: i,
                    speedX: (Math.random() - 0.5) * 0.9,
                    speedY: (Math.random() - 0.5) * 0.9,
                    active: true,
                    angle: 0
                });
            }

            // æ›´æ–°UI
            updateBoardDisplay();
            scoreEl.innerText = collectedCount + ' / 6';
            messageEl.innerText = 'ğŸ å¿«éª‘ä¸Šé©¬èƒŒæ”¶é›†ç¥ç¦ï¼';
            if (animationFrame) cancelAnimationFrame(animationFrame);
            animationFrame = requestAnimationFrame(draw);
        }

        // æ›´æ–°ä¸‹æ–¹ç¥ç¦å¡ç‰‡æ ·å¼
        function updateBoardDisplay() {
            blessTiles.forEach((tile, idx) => {
                if (collected[idx]) {
                    tile.classList.add('collected');
                } else {
                    tile.classList.remove('collected');
                }
            });
            scoreEl.innerText = collectedCount + ' / 6';
        }

        // ---------- æ£€æŸ¥æ”¶é›†: ç‚¹å‡»åæ ‡æ˜¯å¦ç‚¹åˆ°æŸåŒ¹æœªæ”¶é›†çš„éªé©¬ ----------
        function tryCollectHorse(clickX, clickY) {
            // ä»åå¾€å‰ (ä¸Šå±‚è§†è§‰ï¼Œä½†æ— æ‰€è°“)
            for (let i = horses.length - 1; i >= 0; i--) {
                const h = horses[i];
                if (!h.active) continue;       // å·²ç»æ¶ˆå¤±çš„é©¬ä¸å‚ä¸(ä½†è¿™é‡Œactiveå§‹ç»ˆtrue, åªæœ‰æ”¶é›†åç§»é™¤)
                const blessId = h.blessId;
                if (collected[blessId]) continue; // ç¥ç¦å·²å¾—ï¼Œè¿™åŒ¹é©¬å¯ä»¥å¿½ç•¥ï¼Œä½†è¿˜å¯ä»¥ç»§ç»­å­˜åœ¨ä½œä¸ºè£…é¥°ï¼Ÿæˆ‘ä»¬è®¾å®šä¸€æ—¦æ”¶é›†å¯¹åº”ç¥ç¦ï¼Œé‚£åŒ¹é©¬å°±æ¶ˆå¤±ï¼ˆä»£è¡¨ç¥ç¦è¢«å–èµ°ï¼‰
                // ç®€å•çš„åœ†å½¢ç¢°æ’æ£€æµ‹ (é©¬å„¿å¤§çº¦åŠå¾„ä¸º30px)
                const dx = clickX - h.x;
                const dy = clickY - h.y;
                const dist = Math.sqrt(dx*dx + dy*dy);
                if (dist < 40) {  // ç‚¹ä¸­é©¬å„¿
                    // æ ‡è®°è¯¥ç¥ç¦ä¸ºå·²æ”¶é›†
                    if (!collected[blessId]) {
                        collected[blessId] = true;
                        collectedCount++;

                        // æ’­æ”¾æ”¶é›†æ¶ˆæ¯
                        messageEl.innerText = `âœ¨ é›†å¾—ï¼šã€Œ${BLESSINGS[blessId]}ã€âœ¨`;

                        // ç§»é™¤è¿™åŒ¹é©¬ (ä»æ•°ç»„ä¸­åˆ é™¤)
                        horses.splice(i, 1);

                        // æ£€æŸ¥æ˜¯å¦é›†é½å…­å¥
                        if (collectedCount === 6) {
                            messageEl.innerText = 'ğŸ‰ é©¬å¹´å¤§å‰ï¼å…­ç¦ä¸´é—¨ï¼ğŸ‰';
                        }

                        updateBoardDisplay();
                        return true;
                    }
                }
            }
            return false; // æ²¡ç‚¹åˆ°é©¬
        }

        // ---------- canvas ç‚¹å‡»äº‹ä»¶ ----------
        function onCanvasClick(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;   // canvasç‰©ç†åƒç´ æ¯”
            const scaleY = canvas.height / rect.height;

            let clientX, clientY;
            if (e.touches) {
                // è§¦æ‘¸äº‹ä»¶
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
                e.preventDefault();
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            const canvasX = (clientX - rect.left) * scaleX;
            const canvasY = (clientY - rect.top) * scaleY;

            // è¾¹ç•Œé™åˆ¶
            if (canvasX < 0 || canvasX > gameWidth || canvasY < 0 || canvasY > gameHeight) return;

            const collectedAny = tryCollectHorse(canvasX, canvasY);
            if (!collectedAny) {
                messageEl.innerText = 'ğŸ‡ å†é è¿‘ä¸€ç‚¹ï¼Œæ‹æ‹é©¬å„¿~';
            }
        }

        // æ›´æ–°é©¬å„¿ä½ç½® (ç¼“æ…¢é£˜åŠ¨)
        function updateHorses() {
            for (let h of horses) {
                // è¾¹ç•Œåå¼¹ / æŸ”å’Œè½¬å‘
                h.x += h.speedX;
                h.y += h.speedY;

                // ç¢°åˆ°è¾¹ç•Œåå¼¹å¹¶ç•¥å¾®æ”¹å˜é€Ÿåº¦ (å¢åŠ è¶£å‘³)
                if (h.x < 40) { h.x = 40; h.speedX *= -0.9; h.speedY += (Math.random() - 0.5) * 0.2; }
                if (h.x > gameWidth - 40) { h.x = gameWidth - 40; h.speedX *= -0.9; h.speedY += (Math.random() - 0.5) * 0.2; }
                if (h.y < 40) { h.y = 40; h.speedY *= -0.9; h.speedX += (Math.random() - 0.5) * 0.2; }
                if (h.y > gameHeight - 40) { h.y = gameHeight - 40; h.speedY *= -0.9; h.speedX += (Math.random() - 0.5) * 0.2; }

                // é™åˆ¶é€Ÿåº¦èŒƒå›´ï¼Œé¿å…é£å‡º
                h.speedX = Math.min(Math.max(h.speedX, -1.5), 1.5);
                h.speedY = Math.min(Math.max(h.speedY, -1.5), 1.5);

                // è½»å¾®éšæœºæ¸¸èµ°
                if (Math.random() < 0.01) {
                    h.speedX += (Math.random() - 0.5) * 0.4;
                    h.speedY += (Math.random() - 0.5) * 0.4;
                }
            }
        }

        // ---------- ç»˜åˆ¶å¯çˆ±çš„é©¬å„¿ + ç¥ç¦å…ƒç´  ----------
        function draw() {
            ctx.clearRect(0, 0, gameWidth, gameHeight);
            // ç”»è‰åŸèƒŒæ™¯
            ctx.fillStyle = '#bfd8a8';
            ctx.fillRect(0, 0, gameWidth, gameHeight);
            // è£…é¥°äº‘/è‰
            for (let i = 0; i < 12; i++) {
                ctx.fillStyle = '#a7c38b';
                ctx.beginPath();
                ctx.arc(50 + i * 70, 330 + Math.sin(i) * 15, 35, 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.fillStyle = '#ecdbba';
            ctx.font = '26px "æ¥·ä½“", "KaiTi"';
            ctx.fillStyle = '#723e1b';
            ctx.fillText('ğŸ ä¸™åˆå¥”è…¾', 240, 70);

            // æ›´æ–°åæ ‡
            updateHorses();

            // ç»˜åˆ¶é©¬å„¿ (æ¯ä¸€åŒ¹æœªæ”¶é›†çš„)
            for (let h of horses) {
                const id = h.blessId;
                const collectedAlready = collected[id];  // ä½†è‹¥å·²æ”¶é›†ï¼Œé©¬å„¿å·²è¢«ç§»é™¤ï¼Œè¿™é‡Œä¸ä¼šå‡ºç°ã€‚é˜²æ­¢é€»è¾‘é”™è¯¯
                if (collectedAlready) continue;

                // ç»˜åˆ¶éªé©¬è½®å»“ (æ‹ŸäººåŒ–å°é©¬)
                const x = h.x, y = h.y;

                // é©¬èº« (æ¤­åœ†å½¢)
                ctx.shadowColor = '#734d26';
                ctx.shadowBlur = 8;
                ctx.fillStyle = '#b57c4a';
                ctx.beginPath();
                ctx.ellipse(x, y, 28, 20, 0, 0, Math.PI * 2);
                ctx.fill();

                // é©¬å¤´ (å°åœ†)
                ctx.fillStyle = '#c28f5c';
                ctx.beginPath();
                ctx.arc(x + 25, y - 8, 14, 0, 2 * Math.PI);
                ctx.fill();

                // é©¬é¬ƒ
                ctx.fillStyle = '#8b5a2b';
                ctx.beginPath();
                ctx.ellipse(x + 20, y - 18, 8, 12, -0.2, 0, 2 * Math.PI);
                ctx.fill();

                // çœ¼ç›
                ctx.fillStyle = '#111';
                ctx.beginPath();
                ctx.arc(x + 31, y - 13, 3, 0, 2*Math.PI);
                ctx.fill();
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(x + 33, y - 15, 1.2, 0, 2*Math.PI);
                ctx.fill();

                // é©¬è€³æœµ
                ctx.fillStyle = '#a05e2c';
                ctx.beginPath();
                ctx.moveTo(x + 30, y - 26);
                ctx.lineTo(x + 38, y - 32);
                ctx.lineTo(x + 34, y - 22);
                ctx.fill();

                // é©¬èƒŒä¸Šçš„ç¥ç¦å°æ—— (æ˜¾ç¤ºå¯¹åº”emoji)
                ctx.font = '28px "Segoe UI", "æ¥·ä½“", sans-serif';
                ctx.fillStyle = '#faebb7';
                ctx.shadowBlur = 12;
                ctx.fillText(BLESS_ICON[id], x - 8, y - 38);

                // ç¥ç¦æ–‡å­— (é©¬åˆ°æˆåŠŸç­‰å°å­—ï¼Œå¢åŠ å–œåº†)
                ctx.font = 'bold 20px "æ¥·ä½“", "KaiTi"';
                ctx.fillStyle = '#a1270e';
                ctx.shadowBlur = 6;
                ctx.shadowColor = '#fcd295';
                ctx.fillText(BLESSINGS[id].substring(0, 4), x - 27, y - 58); 
            }

            // é‡ç½®é˜´å½±
            ctx.shadowBlur = 0;
            ctx.shadowColor = 'transparent';

            // å¦‚æœé›†é½å…­ç¦ï¼Œæ˜¾ç¤ºå¤§å¤§çš„ç¥è´º
            if (collectedCount === 6) {
                ctx.font = 'bold 48px "æ¥·ä½“", "KaiTi"';
                ctx.fillStyle = '#da3e1b';
                ctx.shadowColor = '#ffcf8a';
                ctx.shadowBlur = 14;
                ctx.fillText('ğŸ é©¬å¹´å¤§å‰', 180, 220);
                ctx.font = '32px "æ¥·ä½“"';
                ctx.fillStyle = '#fef1b9';
                ctx.fillText('ä¸‡äº‹å¦‚æ„', 270, 290);
            }

            animationFrame = requestAnimationFrame(draw);
        }

        // ---------- ç»‘å®šäº‹ä»¶ ----------
        canvas.addEventListener('click', onCanvasClick);
        canvas.addEventListener('touchstart', function(e) {
            e.preventDefault();
            onCanvasClick(e);
        }, { passive: false });

        // é‡ç½®æŒ‰é’®
        document.getElementById('resetBtn').addEventListener('click', function() {
            resetGame();
        });

        // ä¿®æ”¹tileç‚¹å‡»ä¹Ÿèƒ½æœ‰æç¤ºï¼ˆä½†æ”¶é›†å¿…é¡»ç‚¹é©¬ï¼Œç‚¹å¡ç‰‡æ— æ•ˆï¼‰
        blessTiles.forEach((tile, idx) => {
            tile.addEventListener('click', () => {
                if (collected[idx]) {
                    messageEl.innerText = `âœ… å·²æ‹¥æœ‰ã€Œ${BLESSINGS[idx]}ã€`;
                } else {
                    messageEl.innerText = `ğŸ å¿«å»æ‰¾ã€Œ${BLESSINGS[idx]}ã€çš„å°é©¬å§ï¼`;
                }
            });
        });

        // åˆå§‹åŒ–
        resetGame();

        // é€‚é…çª—å£resizeä¸å¹²æ‰°canvasåæ ‡ (canvasç‰©ç†å°ºå¯¸å›ºå®š)
    })();
</script>
</body>
</html>